<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Winemaker04 - Test Suite Viewer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .test-scenario {
      border-left: 4px solid #3b82f6;
      padding-left: 1rem;
      margin: 1rem 0;
    }
    .test-group {
      background: #f9fafb;
      padding: 1.5rem;
      border-radius: 0.5rem;
      margin: 1rem 0;
    }
    code {
      background: #f3f4f6;
      padding: 0.2rem 0.4rem;
      border-radius: 0.25rem;
      font-size: 0.875rem;
    }
    .scenario-example {
      background: #eff6ff;
      padding: 0.75rem;
      border-radius: 0.25rem;
      margin-top: 0.5rem;
      font-size: 0.875rem;
    }
    .config-display {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      padding: 0.75rem;
      border-radius: 0.25rem;
      font-family: 'Courier New', monospace;
      font-size: 0.8rem;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <div class="container mx-auto px-4 py-8 max-w-7xl">
    <!-- Header -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
      <h1 class="text-4xl font-bold text-gray-800 mb-2">
        üß™ Winemaker04 Test Suite Viewer
      </h1>
      <p class="text-gray-600 mb-4">
        Interactive view of all test scenarios, configurations, and what's being validated
      </p>
      <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4">
        <p class="text-sm text-blue-800">
          <strong>Note:</strong> This is a standalone viewer. Tests don't run here - use <code>npm test</code> in terminal.
          This viewer helps you understand what scenarios are tested and with what data.
        </p>
      </div>
      <div class="mt-4 flex gap-4 flex-wrap">
        <button onclick="loadAllTests()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
          üîÑ Load Test Information
        </button>
        <a href="../tests/README.md" target="_blank" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 inline-block">
          üìñ View Test README
        </a>
        <a href="../tests" target="_blank" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 inline-block">
          üìÅ Browse Test Files
        </a>
      </div>
    </div>

    <!-- Loading State -->
    <div id="loadingState" class="bg-white rounded-lg shadow-md p-8 text-center hidden">
      <p class="text-gray-600">Loading test information...</p>
    </div>

    <!-- Test Suites -->
    <div id="testSuites" class="space-y-6">
      <!-- Test suites will be inserted here -->
    </div>
  </div>

  <script type="module">
    // Comprehensive test metadata extracted from actual test files
    const testMetadata = {
      'vineyard/yieldCalculator': {
        title: 'Vineyard Yield Calculator',
        description: 'Tests the core vineyard yield formula that determines grape production when harvesting',
        formula: 'yield = (hectares √ó density √ó 1.5 kg/vine) √ó (suitability √ó naturalYield √ó ripeness √ó vineYield √ó health)',
        impact: 'Directly affects wine production capacity and game economy balance',
        file: 'tests/vineyard/yieldCalculator.test.ts',
        groups: [
          {
            name: 'Edge Cases - Prevents Game-Breaking Bugs',
            description: 'Tests boundary conditions that could break the game',
            tests: [
              {
                name: 'returns 0 kg when vineyard has no grape variety planted',
                scenario: 'Player hasn\'t planted grapes yet',
                expected: 'No yield possible (cannot harvest barren land)',
                whyItMatters: 'Prevents harvesting from empty vineyards',
                example: 'vineyard.grape = null ‚Üí yield = 0 kg'
              },
              {
                name: 'returns 0 kg when grapes are unripe',
                scenario: 'Player tries to harvest at 0% ripeness',
                expected: 'Zero yield (grapes not ready)',
                whyItMatters: 'Forces players to wait for proper harvest timing',
                example: 'ripeness = 0 ‚Üí yield = 0 kg'
              },
              {
                name: 'handles missing optional fields gracefully',
                scenario: 'Database returns incomplete vineyard data',
                expected: 'Function doesn\'t crash, returns 0 safely',
                whyItMatters: 'Prevents save file corruption from breaking the game'
              }
            ]
          },
          {
            name: 'Scale Factors - Ensures Realistic Vineyard Economics',
            description: 'Validates that vineyard size and density scale correctly',
            tests: [
              {
                name: 'yield scales proportionally with vineyard size',
                scenario: 'Player buys a larger vineyard (2 hectares vs 1 hectare)',
                expected: 'Double the size = double the grapes',
                whyItMatters: 'Makes vineyard purchases economically sensible',
                example: '1 hectare ‚Üí ~12,000 kg | 2 hectares ‚Üí ~24,000 kg'
              },
              {
                name: 'yield scales proportionally with vine density',
                scenario: 'High-density planting (5,000 vines/ha) vs standard (2,500 vines/ha)',
                expected: 'More vines per hectare = more grapes',
                whyItMatters: 'Dense planting is a valid strategy (requires more work)',
                example: '2,500 vines/ha ‚Üí ~6,000 kg | 5,000 vines/ha ‚Üí ~12,000 kg'
              }
            ]
          },
          {
            name: 'Quality Multipliers - Rewards Good Vineyard Management',
            description: 'Tests that good management (health, ripeness, vine age) increases yields',
            tests: [
              {
                name: 'damaged vineyards produce roughly half the yield',
                scenario: 'Neglected vineyard (50% health) vs well-maintained (100% health)',
                expected: 'Poor health = lower yields',
                whyItMatters: 'Incentivizes players to maintain vineyards (clearing activities)',
                example: 'Health 100% ‚Üí ~12,000 kg | Health 50% ‚Üí ~6,000 kg'
              },
              {
                name: 'riper grapes produce roughly double the yield',
                scenario: 'Early harvest (40% ripeness) vs optimal harvest (80% ripeness)',
                expected: 'Waiting for ripeness = significantly more grapes',
                whyItMatters: 'Creates strategic timing decisions (harvest early or wait?)',
                example: 'Ripeness 40% ‚Üí ~6,000 kg | Ripeness 80% ‚Üí ~12,000 kg'
              },
              {
                name: 'mature vines produce double the yield of young vines',
                scenario: 'Newly planted vineyard (50% vineYield) vs established (100% vineYield)',
                expected: 'Vine age affects yield potential',
                whyItMatters: 'Rewards long-term vineyard investments',
                example: 'Young vines (50%) ‚Üí ~6,000 kg | Mature vines (100%) ‚Üí ~12,000 kg'
              }
            ]
          }
        ],
        testConfigs: {
          baseVineyard: {
            name: 'Base Test Vineyard',
            config: {
              hectares: 1,
              density: 5000,
              grape: 'Sangiovese',
              country: 'Italy',
              region: 'Tuscany',
              health: 1.0,
              ripeness: 0.8,
              vineYield: 1.0
            },
            description: 'Standard well-maintained vineyard used as baseline for comparisons'
          },
          optimalVineyard: {
            name: 'Optimal 5-hectare Vineyard',
            config: {
              hectares: 5,
              density: 5000,
              grape: 'Sangiovese',
              health: 0.95,
              ripeness: 0.9,
              vineYield: 1.0
            },
            expected: 'Produces substantial but realistic yield (10,000-100,000 kg)',
            description: 'Large-scale vineyard in perfect condition'
          },
          damagedVineyard: {
            name: 'Damaged Vineyard',
            config: {
              hectares: 1,
              density: 5000,
              health: 0.5,
              ripeness: 0.8
            },
            expected: 'Produces ~50% of healthy vineyard yield',
            description: 'Neglected vineyard showing reduced yields'
          }
        }
      },
      'finance/wageService': {
        title: 'Staff Wage Calculator',
        description: 'Tests wage calculation based on staff skills and specializations',
        formula: 'wage = (BASE_WAGE + avgSkill √ó SKILL_MULTIPLIER) √ó specializationBonus^count',
        impact: 'Affects staff hiring costs and monthly expenses',
        file: 'tests/finance/wageService.test.ts',
        groups: [
          {
            name: 'Skill-Based Wages',
            tests: [
              {
                name: 'calculates base wage for average skills without specializations',
                scenario: 'Staff member with 0.5 average skill level, no specializations',
                expected: 'Base: 500 + (0.5 √ó 1000) = 1,000‚Ç¨/week',
                example: 'All skills at 0.5 ‚Üí 1,000‚Ç¨/week'
              },
              {
                name: 'increases wage with higher average skills',
                scenario: 'Experienced staff member (0.8 skills) vs beginner (0.3 skills)',
                expected: 'Higher skills = higher wages',
                example: 'Skills 0.3 ‚Üí ~800‚Ç¨ | Skills 0.8 ‚Üí ~1,300‚Ç¨'
              },
              {
                name: 'handles minimum skills (all zeros)',
                scenario: 'Newly hired staff with no experience',
                expected: 'Base: 500 + (0 √ó 1000) = 500‚Ç¨/week',
                example: 'Minimum wage: 500‚Ç¨/week'
              },
              {
                name: 'handles maximum skills (all ones)',
                scenario: 'Expert staff member with perfect skills',
                expected: 'Base: 500 + (1.0 √ó 1000) = 1,500‚Ç¨/week',
                example: 'Maximum base wage: 1,500‚Ç¨/week'
              }
            ]
          },
          {
            name: 'Specialization Bonuses',
            tests: [
              {
                name: 'applies specialization bonus multiplicatively',
                scenario: 'Staff with 1-5 specializations',
                expected: 'Each specialization adds 30% bonus (multiplicative: 1.3^count)',
                whyItMatters: 'Rewards highly specialized staff appropriately',
                example: '0 specs: 1,000‚Ç¨ | 1 spec: 1,300‚Ç¨ | 2 specs: 1,690‚Ç¨ | 3 specs: 2,197‚Ç¨'
              }
            ]
          }
        ],
        testConfigs: {
          baseStaff: {
            name: 'Base Staff Member',
            config: {
              skills: { field: 0.5, winery: 0.5, admin: 0.5, sales: 0.5, maintenance: 0.5 },
              specializations: []
            },
            expected: '1,000‚Ç¨/week',
            description: 'Average staff member with no specializations'
          },
          specializedWorker: {
            name: 'Specialized Field Worker',
            config: {
              skills: { field: 0.8, winery: 0.4, admin: 0.2, sales: 0.3, maintenance: 0.3 },
              specializations: ['field']
            },
            expected: '~1,300‚Ç¨/week',
            description: 'Worker specialized in field operations'
          }
        }
      },
      'finance/loanService': {
        title: 'Loan Interest Calculator',
        description: 'Tests loan interest rate calculations with economy, lender type, and credit rating modifiers',
        formula: 'effectiveRate = baseRate √ó economyMultiplier √ó lenderMultiplier √ó creditMultiplier √ó durationMultiplier',
        impact: 'Affects loan costs and financial planning',
        file: 'tests/finance/loanService.test.ts',
        groups: [
          {
            name: 'Economy Phase Effects',
            tests: [
              {
                name: 'applies economy phase multipliers correctly',
                scenario: 'Borrowing during different economic conditions',
                expected: 'Recession = higher rates | Expansion = lower rates',
                example: 'Base 5% ‚Üí Recession ~7.5% | Expansion ~2.5%'
              }
            ]
          },
          {
            name: 'Lender Type Effects',
            tests: [
              {
                name: 'applies lender type multipliers correctly',
                scenario: 'Different lender types offer different rates',
                expected: 'Bank = lowest rates | QuickLoan = highest rates',
                example: 'Bank: ~4.5% | Private Lender: ~7% | QuickLoan: ~8%'
              }
            ]
          },
          {
            name: 'Credit Rating Effects',
            tests: [
              {
                name: 'applies credit rating modifier correctly',
                scenario: 'Good credit vs poor credit',
                expected: 'Better credit = lower interest rates',
                example: 'Credit 0.9 ‚Üí ~5% | Credit 0.3 ‚Üí ~9%'
              }
            ]
          }
        ],
        testConfigs: {
          standardLoan: {
            name: 'Standard Bank Loan',
            config: {
              baseRate: 0.05,
              economyPhase: 'Expansion',
              lenderType: 'Bank',
              creditRating: 0.7
            },
            expected: 'Lower interest rate due to good economy and bank lender'
          },
          highRiskLoan: {
            name: 'QuickLoan High Risk',
            config: {
              baseRate: 0.12,
              economyPhase: 'Recession',
              lenderType: 'QuickLoan',
              creditRating: 0.3
            },
            expected: 'High interest rate due to poor economy, risky lender, and low credit'
          }
        }
      }
    };

    function renderTestSuite(key, suite) {
      return `
        <div class="bg-white rounded-lg shadow-md p-6">
          <div class="flex items-start justify-between mb-4">
            <div>
              <h2 class="text-3xl font-bold text-gray-800 mb-2">${suite.title}</h2>
              <p class="text-gray-600 mb-4">${suite.description}</p>
              ${suite.file ? `<p class="text-sm text-gray-500">File: <code>${suite.file}</code></p>` : ''}
            </div>
          </div>
          
          ${suite.formula ? `
            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4">
              <p class="font-semibold text-blue-900 mb-1">Formula:</p>
              <code class="text-blue-800">${suite.formula}</code>
            </div>
          ` : ''}
          
          ${suite.impact ? `
            <div class="bg-green-50 border-l-4 border-green-500 p-4 mb-4">
              <p class="font-semibold text-green-900">Game Impact:</p>
              <p class="text-green-800">${suite.impact}</p>
            </div>
          ` : ''}

          ${suite.groups ? suite.groups.map(group => `
            <div class="test-group mt-6">
              <h3 class="text-xl font-bold text-gray-800 mb-2">${group.name}</h3>
              ${group.description ? `<p class="text-gray-600 mb-4">${group.description}</p>` : ''}
              ${group.tests.map(test => `
                <div class="test-scenario mb-4">
                  <h4 class="font-semibold text-gray-800 mb-2">${test.name}</h4>
                  <div class="text-sm text-gray-600 space-y-1">
                    ${test.scenario ? `<p><strong>Scenario:</strong> ${test.scenario}</p>` : ''}
                    ${test.expected ? `<p><strong>Expected:</strong> ${test.expected}</p>` : ''}
                    ${test.whyItMatters ? `<p><strong>Why It Matters:</strong> ${test.whyItMatters}</p>` : ''}
                    ${test.example ? `
                      <div class="scenario-example">
                        <strong>Example:</strong> ${test.example}
                      </div>
                    ` : ''}
                  </div>
                </div>
              `).join('')}
            </div>
          `).join('') : ''}

          ${suite.testConfigs ? `
            <div class="mt-6 border-t pt-6">
              <h3 class="text-xl font-bold text-gray-800 mb-4">Test Configurations</h3>
              ${Object.entries(suite.testConfigs).map(([configKey, config]) => `
                <div class="bg-gray-50 p-4 rounded mb-3">
                  <h4 class="font-semibold mb-2">${config.name}</h4>
                  ${config.description ? `<p class="text-sm text-gray-600 mb-2">${config.description}</p>` : ''}
                  <div class="config-display mb-2">
                    ${JSON.stringify(config.config, null, 2)}
                  </div>
                  ${config.expected ? `<p class="text-sm text-gray-600"><strong>Expected Result:</strong> ${config.expected}</p>` : ''}
                </div>
              `).join('')}
            </div>
          ` : ''}
        </div>
      `;
    }

    function loadAllTests() {
      const container = document.getElementById('testSuites');
      const loading = document.getElementById('loadingState');
      
      loading.classList.remove('hidden');
      container.innerHTML = '';

      setTimeout(() => {
        loading.classList.add('hidden');
        Object.entries(testMetadata).forEach(([key, suite]) => {
          container.innerHTML += renderTestSuite(key, suite);
        });
      }, 300);
    }

    // Initialize on load
    window.addEventListener('DOMContentLoaded', () => {
      loadAllTests();
    });
    window.loadAllTests = loadAllTests;
  </script>
</body>
</html>
